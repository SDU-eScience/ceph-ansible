ceph config set global mon_target_pg_per_osd 100
ceph config set global osd_pool_default_pg_autoscale_mode on

ceph osd erasure-code-profile set ec_83h k=8 m=3 crush-failure-domain=host plugin=jerasure technique=reed_sol_van
ceph osd pool create cephfs_data 1024 1024 erasure ec_83h
ceph osd pool set cephfs_data target_size_ratio .5
ceph osd pool set cephfs_data allow_ec_overwrites true
ceph osd pool create cephfs_metadata 512 512 replicated
ceph osd pool set cephfs_metadata target_size_ratio .05

#ceph osd pool set cephfs_data pg_num 1024

# ceph k8s
ceph --cluster ceph auth get-or-create client.kube mon 'allow r' osd 'allow rwx pool=kube'


# ceph balancer
ceph osd set-require-min-compat-client luminous
ceph balancer mode upmap
ceph balancer on

# dashboard
yum install ceph-mgr-dashboard
ceph mgr module enable dashboard
ceph dashboard create-self-signed-cert
firewall-cmd --permanent --add-port=8443/tcp
ceph dashboard ac-user-create user pass administrator



# notes
# to be able to remove a pool
ceph tell mon.\* injectargs '--mon-allow-pool-delete=true'
ceph osd pool delete testbench testbench --yes-i-really-really-mean-it


# enable NAT ## to delete the rule change -A with -D 
# to list all rules -S 
# -t NAT select the NAT table 
iptables -t nat -A POSTROUTING -o p3p1.99 -j MASQUERADE
iptables -A FORWARD -i p3p1.99 -o p3p1 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT
iptables -A FORWARD -i p3p1 -o p3p1.99 -j ACCEPT
sysctl -w net.ipv4.ip_forward=1

