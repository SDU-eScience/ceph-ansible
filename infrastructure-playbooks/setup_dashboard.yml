---
- name: Install required packages
  hosts: mons
  become: true

  vars:
    dash_packages:
      - ceph-mgr-dashboard

  tasks:
    - package:
        name: "{{ item }}"
        state: present
      loop: "{{ dash_packages }}"

- name: Wait to finish installation
  hosts: mons

  tasks:
    - command: "sleep 3"
      run_once: true

- name: Activate dashboard module
  hosts: mons[0]
  become: true

  tasks:
    - command: "ceph mgr module enable dashboard"
      run_once: true

- name: Wait for dashboard
  hosts: mons

  tasks:
    - command: "sleep 3"
      run_once: true

- name: Create self-signed certificate
  hosts: mons[0]
  become: true

  tasks:
    - command: "ceph dashboard create-self-signed-cert"
      run_once: true


